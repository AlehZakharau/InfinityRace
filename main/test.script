local file_path = "/Users/alehzakharau/Documents/Defold/Projects/InfinityRace/data/"
local file_track_1_name = "track_1.txt"
local file_track_2_name = "track_2.txt"
local match_pattern = "([^,]*),([^,]*),([^,]*),([^,]*)"

local car_1 = "/go1"
local car_2 = "/go2"

local track_1 = {}
local track_2 = {}
local index_1 = 1
local index_2 = 100
local time = 0

function init(self)
	local path = file_path .. file_track_1_name
	local file = io.open(path)
	for line in io.lines(path) do
		local a, x, y, track = line:match(match_pattern)
		local id = tonumber(a)
		track_1[id] = {position = vmath.vector3(x, y, 0)}
	end
	file:close()
	path = file_path .. file_track_2_name
	file = io.open(path)
	for line in io.lines(path) do
		local a, x, y, track = line:match(match_pattern)
		local id = tonumber(a)
		track_2[id] = {position = vmath.vector3(x, y, 0)}
	end
	file:close()
end

local car_1_moved = true
local car_1_speed = 5000

local function moved()
	car_1_moved = true
end

local function move_car(track, index, car, car_speed, callback)
	local current_position = track[index].position
	car_1_moved = false
	index = index + car_speed
	if index > #track then index = 1 end
	local target_position = track[index].position
	local distance = vmath.length(target_position - current_position)
	local duration = distance / car_1_speed
	--go.set_position(new_position, car)
	go.animate(car, "position", go.PLAYBACK_ONCE_FORWARD, target_position, go.EASING_OUTSINE, duration, 0, callback) -- <8>
	return index
end

local function switch_track()
	-- switch index
	-- change track
	-- move to connect index
	-- lick opponent
end

function update(self, dt)
	time = time + dt
	--if time > .1 then
	--	index_1 = move_car(track_1, index_1, car_1, 1)
	--	index_2 = move_car(track_2, index_2, car_2, 5)
	--	time = 0
	--end
	if car_1_moved == true then 
		index_1 = move_car(track_1, index_1, car_1, 1, moved)
	end
end
